# ===========================================
# {{ task_name }} 訓練配置
# 自動生成: {{ generated_date }}
# ===========================================

# === 模型配置 ===
model:
  base_model: "{{ base_model }}"
  trust_remote_code: true

# === 資料配置 ===
data:
  train_file: "data/chat_format/train.jsonl"
  valid_file: "data/chat_format/valid.jsonl"
  test_file: "data/test.jsonl"

# === LoRA 配置 ===
lora:
  r: {{ lora_r }}
  lora_alpha: {{ lora_alpha }}
  lora_dropout: {{ lora_dropout }}
  target_modules:
    {% for module in target_modules %}
    - {{ module }}
    {% endfor %}
  bias: "none"
  task_type: "CAUSAL_LM"

# === 訓練參數 ===
training:
  method: "{{ method }}"
  num_train_epochs: {{ epochs }}
  per_device_train_batch_size: {{ batch_size }}
  gradient_accumulation_steps: {{ gradient_accumulation }}
  learning_rate: {{ learning_rate }}
  warmup_ratio: 0.1
  weight_decay: 0.01
  max_seq_length: {{ max_seq_length }}
  logging_steps: 10
  save_strategy: "epoch"
  evaluation_strategy: "epoch"
  load_best_model_at_end: true
  bf16: true

{% if method == 'orpo' %}
# === ORPO 配置 ===
orpo:
  beta: {{ orpo_beta | default(0.1) }}
{% endif %}

# === 輸出配置 ===
output:
  output_dir: "models/adapter"
  logging_dir: "models/adapter/logs"

# === 硬體配置 ===
hardware:
  device_map: "auto"
  torch_dtype: "bfloat16"
